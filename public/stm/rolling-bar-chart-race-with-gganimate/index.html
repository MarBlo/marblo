
<!DOCTYPE HTML>

<html>
    <head>
        <script>
          function resizeIframe(obj) {
            obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
          }
        </script>
        <script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"></script>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "stm",
        "name" : "Rolling Bar Chart Race with gganimate",
        "headline" : "Rolling Bar Chart Race with gganimate",
        "description" : "Rolling Bar Chart Race Diese Art der dynamischen Darstellung schien mir gut geeignet zu sein, um die Veränderungen unter den Topx im Laufe einer Saison darzustellen. Inspiration und gute Hinweise habe ich über die beiden Seiten emilykuehler und towardsdatascience bekommen.\nDie Dynamik soll dadurch entstehen, dass die Topx sich wöchentlich ändern. Daraus entsteht die Notwendigkeit, für jede Woche für ALLE Fahrer ein neues Ranking zu erstellen und daraus die Topx zu filtern.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-01-04 00:00:00 \x2b0000 UTC",
        "dateModified" : "2020-01-04 00:00:00 \x2b0000 UTC",
        "url" : "\/stm\/rolling-bar-chart-race-with-gganimate\/",
        "wordCount" : "1292",
        "keywords" : [ "Blog" ]
    }
    </script>
        
            
                <title>Rolling Bar Chart Race with gganimate</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.59.0" />
        
  
    
  

  

  <link rel="apple-touch-icon-precomposed" href='../../favicon/apple-touch-icon-precomposed.png'>
  
  <link rel="icon" type="png" href="../../img/main/favicon_I.png">
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="mb`s">
  <meta name="msapplication-tooltip" content="Radsport, Amateure, Profis, Rangliste">
  <meta name="msapplication-config" content='/favicon/ieconfig.xml'>



        
            <meta name="author" content="Martin">
        
        
            
                <meta name="description" content="Radsport, Amateure, Profis, Rangliste">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rolling Bar Chart Race with gganimate"/>
<meta name="twitter:description" content="Rolling Bar Chart Race Diese Art der dynamischen Darstellung schien mir gut geeignet zu sein, um die Veränderungen unter den Topx im Laufe einer Saison darzustellen. Inspiration und gute Hinweise habe ich über die beiden Seiten emilykuehler und towardsdatascience bekommen.
Die Dynamik soll dadurch entstehen, dass die Topx sich wöchentlich ändern. Daraus entsteht die Notwendigkeit, für jede Woche für ALLE Fahrer ein neues Ranking zu erstellen und daraus die Topx zu filtern."/>
<meta name="twitter:site" content="@true"/>

        <meta property="og:title" content="Rolling Bar Chart Race with gganimate" />
<meta property="og:description" content="Rolling Bar Chart Race Diese Art der dynamischen Darstellung schien mir gut geeignet zu sein, um die Veränderungen unter den Topx im Laufe einer Saison darzustellen. Inspiration und gute Hinweise habe ich über die beiden Seiten emilykuehler und towardsdatascience bekommen.
Die Dynamik soll dadurch entstehen, dass die Topx sich wöchentlich ändern. Daraus entsteht die Notwendigkeit, für jede Woche für ALLE Fahrer ein neues Ranking zu erstellen und daraus die Topx zu filtern." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/stm/rolling-bar-chart-race-with-gganimate/" />
<meta property="article:published_time" content="2020-01-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-04T00:00:00+00:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Rolling Bar Chart Race with gganimate">
<meta itemprop="description" content="Rolling Bar Chart Race Diese Art der dynamischen Darstellung schien mir gut geeignet zu sein, um die Veränderungen unter den Topx im Laufe einer Saison darzustellen. Inspiration und gute Hinweise habe ich über die beiden Seiten emilykuehler und towardsdatascience bekommen.
Die Dynamik soll dadurch entstehen, dass die Topx sich wöchentlich ändern. Daraus entsteht die Notwendigkeit, für jede Woche für ALLE Fahrer ein neues Ranking zu erstellen und daraus die Topx zu filtern.">


<meta itemprop="datePublished" content="2020-01-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-01-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1292">



<meta itemprop="keywords" content="" />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="../../css/main.css">
            <link rel="stylesheet" href="../../css/add-on.css">
            <link rel="stylesheet" href="../../css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-154196797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="../../">stm</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="../../">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="../../about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="../../blog/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="../../stm/">
                            <i class="">&nbsp;</i>Sent To Myself
                    </a>
                </li>
            
                <li>
                    <a href="../../apps/">
                            <i class="fa fa-list">&nbsp;</i>Apps
                    </a>
                </li>
            
                <li>
                    <a href="../../categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="../../contact/">
                            <i class="fa fa-envelope-o">&nbsp;</i>Contact
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="../../">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../blog/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../stm/">
                            <h3>
                                <i class="">&nbsp;</i>Sent To Myself
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../apps/">
                            <h3>
                                <i class="fa fa-list">&nbsp;</i>Apps
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="../../contact/">
                            <h3>
                                <i class="fa fa-envelope-o">&nbsp;</i>Contact
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="../../blog/amateurradsport-radsport-rangliste-amateure/">Rangliste Amateure 2019</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-02-02'>
                                    February 2, 2020</time>
                            </header>
                            
    

    
        
        







  
  
    
  


        
        
        

        <a href="../../blog/amateurradsport-radsport-rangliste-amateure/" class="image featured">
            <img src="../../img/2020/02/ranking.png" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="../../stm/sublime-markdown-text-css-und-mehr/">Sublime, Markdown, Text, CSS und mehr</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-01-26'>
                                    January 26, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="../../stm/how-to-add-interactive-plots-to-a-blog-post/">How to add interactive plots to a Blog post</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-01-22'>
                                    January 22, 2020</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            

























        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="../../stm/rolling-bar-chart-race-with-gganimate/">Rolling Bar Chart Race with gganimate</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2020-01-04'>
            January 4, 2020</time>
        <span class="author">Martin</span>
        
            <p>7 minute read</p>
        
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        

























      </ul>
    </section>
  

  
    

    
        
        







  
  
    
  


        
        
        

        <a href="../../stm/rolling-bar-chart-race-with-gganimate/" class="image featured">
            <img src="../../img/2020/01/headup.jpg" alt="">
        </a>
    


  <div id="content">
    

<h1 id="rolling-bar-chart-race">Rolling Bar Chart Race</h1>

<p>Diese Art der dynamischen Darstellung schien mir gut geeignet zu sein, um die Veränderungen unter den
<span style="font-weight:bold; font-size: 1.2em;">Topx</span> im Laufe einer Saison darzustellen. Inspiration und gute
Hinweise habe ich über die beiden Seiten <a href="https://emilykuehler.github.io/bar-chart-race/">emilykuehler</a> und
<a href="https://towardsdatascience.com/how-to-create-plots-with-beautiful-animation-using-gganimate-912f4279b073">towardsdatascience</a>
bekommen.</p>

<p>Die Dynamik soll dadurch entstehen, dass die <span style="font-weight:bold; font-size: 1.2em;">Topx</span> sich
wöchentlich ändern. Daraus entsteht die Notwendigkeit, für jede Woche für <strong>ALLE</strong> Fahrer ein neues Ranking zu erstellen
und daraus die <span style="font-weight:bold; font-size: 1.2em;">Topx</span> zu filtern.</p>

<p>Das bedeutet einen erheblichen Aufwand bei der Datenaufbereitung, die hier beschrieben werden soll. Ausgangspunkt ist
der Datensatz <em>ergebB</em> der alle Ergebnisse aus den Jahren 2018 und 2019 enthält.</p>

<pre><code class="language-r">library(tidyverse)
library(here)
library(plotly)

rm(list = ls())

ergebB &lt;- readRDS(here(&quot;data&quot;, &quot;processed&quot;, &quot;ergebB.rds&quot;))
</code></pre>

<p>Danach werden Teams und Fahrer für jeweils Amateure, KT&rsquo;s und Profis extrahiert.</p>

<pre><code class="language-r"># ----------------------------------------------------------------
# --- Teams und Fahrer
# ----------------------------------------------------------------
# --- Teams 2019 -------------------------------------------------
alleTeams2019 &lt;- ergebB %&gt;%
  filter(Jahr == 2019) %&gt;%
  distinct(Team)
alleVereine2019 &lt;- ergebB %&gt;%
  filter(Jahr == 2019) %&gt;%
  distinct(Verein)
# --- Profis 2019 -------------------------------------------------
Profi_teams2019 &lt;- alleTeams2019 %&gt;%
  filter(str_detect(Team, &quot;BORA|Trek|Soudal|Quick|Katusha|Sunweb|Bahrain|Lotto Soudal|
                          |Visma|Arkea|Movis|CCC|AG2R|Hrinkow|Mitchelton|Sapura|Corendon|
                          |Sky|INEOS&quot;)) %&gt;%
  filter(Team != &quot;Development Team Sunweb&quot;)
Profi_teams2019
Profi_fahrer2019 &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;% 
  filter(Team %in% Profi_teams2019$Team) %&gt;%
  distinct(Name)
Profi_fahrer2019
# --- KT's 2019 -------------------------------------------------
KT_teams2019 &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;%
  filter(is.na(Verein) &amp; !Team %in% Profi_teams2019$Team) %&gt;%
  distinct(Team)
KT_teams2019
KT_fahrer2019 &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;%
  filter(Team %in% KT_teams2019$Team) %&gt;%
  distinct(Name)
KT_fahrer2019
# --- Amateure 2019 -------------------------------------------------
Amateur_teams2019 &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;%
  filter(!Team %in% Profi_teams2019$Team &amp; !Team %in% KT_teams2019$Team) %&gt;%
  distinct(Team)
Amateur_teams2019
Amateur_fahrer2019 &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;%
  filter(Team %in% Amateur_teams2019$Team) %&gt;%
  distinct(Name)
Amateur_fahrer2019
</code></pre>

<p>Dann werden die Rennen definiert, die <strong>NICHT</strong> mit in die Auswertung kommen sollen. Damit will ich sicherstellen, dass
nur vom BDR ausgeschriebene Rennen berücksichtigt werden. Fahrer, die sich den überwiegenden Teil Ihrer Platzierungen
und Punkte in Afrika oder Indonesien holen werden hier schon einmal rausgefiltert, bzw die dort stattgefundenen Rennen.</p>

<pre><code class="language-r">rennenNA &lt;- ergebB %&gt;%
  filter(is.na(Kategorie) | is.na(Ort) |
           str_detect(Veranstaltun, &quot;Rwanda|Mevla|d'Alg|Mersin|Solidarnosc|Tour of Austria|
                              Oberösterreichrundfahrt|GP Adria Mobil (SLO)|Sahara|
                              GP Adria Mobil (SLO)|Umag|Xingtai|Ras Tailteann|Maroc|
                              Deutschland Tour|Rhodes|BinckBank|Wallonie|Slov|
                              York|Dubai|China|Baltic|Indonesia|Rhône-Alpes|
                              Course de la Paix|Carpathian|Qinghai|Antalya|Mallorca|
                              Marche verte|(FRA)|(ROU)|(CHN)|(BEL)|(AUT)|(IRL)|(GBR)|(NED)|
                              (ESP)|(POR)|(SPA)|(IRN)|(MAR)|(RSA)|(SLO)&quot;)) %&gt;%
  distinct(Datum, Ort, Veranstaltun)
</code></pre>

<p>Eine weitere Filterung geschieht im folgenden über den Typ der Rennen.
Außerdem wird das Datum gesäubert und eine column für die Woche eingefügt.</p>

<pre><code class="language-python">purrTest &lt;- ergebB %&gt;% filter(Jahr == 2019) %&gt;%
  filter(str_detect(Typ, 'SR|RR|Kri.|Kri|BZF|EZF|MZF|GW|Ausscheidungsf.|Temporennen')) %&gt;%
  filter(!str_detect(Kategorie, 'XC')) %&gt;%
  filter(Name %in% Amateur_fahrer2019$Name) %&gt;%
  filter(!Veranstaltun %in% rennenNA$Veranstaltun) %&gt;%
  mutate(Datum = lubridate::dmy(str_sub(Datum,-10))) %&gt;%  
  group_by(week = lubridate::week(Datum), Name, Team)
</code></pre>

<p>Die folgende loop läuft durch alle Wochen mit Ergebnissen und macht pro Woche ein eigenes Ranking und Addition der
Punkte.</p>

<pre><code class="language-r">df_fahrer &lt;- data.frame(matrix(ncol = 5, nrow = 0))
x &lt;- c(&quot;Name&quot;, &quot;Team&quot;, &quot;week&quot;, 'Verein',&quot;c&quot;)
colnames(df_fahrer) &lt;- x
df_temp &lt;- data.frame()
for (we in seq(10,41,1)){
  df_temp &lt;- purrTest %&gt;% filter(week &lt;= we) %&gt;% 
    group_by(Name, Team, week, Verein) %&gt;% 
    summarise(c = sum(Punkte, na.rm = T))
  df_fahrer &lt;- bind_rows(df_fahrer, df_temp)%&gt;% distinct()
}
</code></pre>

<p>Einzelne Fahrer haben in bestimmten Wochen keine Punkte
 gesammelt. Für die Darstellung muss die Woche aber eine
 kontinuierliche Folge sein. Das wird hier mit <strong>complete</strong>
 gemacht. Danach wird für jede - jetzt lückenlose -
 Wochenfolge neuer Rank und Punkte pro Fahrer ermittelt
 Teams mit NA werden auf &lsquo;farblos&rsquo; gesetzt</p>

<pre><code class="language-r">fahrer_Rank_Week &lt;- df_fahrer %&gt;% 
  complete(week, nesting(Name, Team, Verein)) %&gt;% 
  unnest() %&gt;% 
  mutate(c = replace_na(c, 0)) %&gt;% ungroup() %&gt;% 
  group_by(Name, Team, Verein) %&gt;% 
  mutate(SumInWeek = cumsum(c)) %&gt;% 
  ungroup() %&gt;% 
  group_by(week) %&gt;% 
  mutate(RankInWeek = min_rank(-SumInWeek)) %&gt;% 
  mutate(Team = ifelse(is.na(Team), 'farblos', Team))
</code></pre>

<p>Hier werden die Farben für die Teams gemacht - ist bestimmt noch zu verbessern.</p>

<pre><code class="language-r">nb.cols &lt;- length(unique(fahrer_Rank_Week$Team))
mycolors &lt;- colorRampPalette(brewer.pal(8, &quot;Dark2&quot;))(nb.cols)
tea &lt;-  unique(fahrer_Rank_Week$Team)
teamColor &lt;- data.frame(tea, mycolors) 
teamColor$tea &lt;- as.character(teamColor$tea)
teamColor$mycolors &lt;- as.character(teamColor$mycolors)
teamColor &lt;- teamColor %&gt;% 
  mutate(mycolors = case_when(
    str_detect(tea, 'Ehrmann') ~ 'cadetblue1',
    str_detect(tea, 'Erdinger') ~ 'antiquewhite',
    str_detect(tea, 'Kempten') ~ 'darkgray',
    str_detect(tea, 'Belle') ~ 'aquamarine2',
    str_detect(tea, 'Sigloch') ~ 'bisque2',
    str_detect(tea, 'erdgas') ~ 'lavenderblush2',
    str_detect(tea, 'Kern-Haus') ~ 'lightsalmon',
    TRUE ~ 'gray93'
  ))

whatyouwant &lt;- setNames(as.character(teamColor$mycolors), as.character(teamColor$tea))
</code></pre>

<p>Hier wird das gganimate gemacht.
 dat ist wichtig, hier wird eine neue column eingeführt, die
 für jede Woche eine neue &lsquo;ordering&rsquo; macht. Das dient auch dazu,
 Bei Punktgleichheit Fahrer nicht übereinander darzustellen
 im Ranking sondern hintereinander, geordnet nach Fahrername
 NB: Wenn man in dat den filter(week==40) benutzt und im
     folgenden ggplot die animation abschaltet, kann man
     man ein statisches Plot machen und das tunen</p>

<pre><code class="language-r">dat &lt;- fahrer_Rank_Week %&gt;% 
  group_by(week) %&gt;% 
  # nächste Zeile auskommentieren für statischen Plot
  #filter(week == 40) %&gt;% 
  arrange(RankInWeek, Team) %&gt;% 
  mutate(ordering = row_number()) %&gt;% 
  filter(RankInWeek &lt;= 20)
</code></pre>

<p>Das eigentliche ggplot. Hier kommt <strong>geom_tile</strong> zum Tragen. Das brauch in aes ein y und in dem übergeordnetetn aes wird
das x mit <strong>odering</strong> gemacht. Dann folgen drei künstliche gridlines, die ursprünglichen gingen zu weit oben und unten
hinaus und werden unten abgeschaltet in <strong>themes</strong>.
Das geom_tile wird halbiert und die <em>height</em> macht die eigentliche Balkenhöhe. Die <em>width</em> wird auf 0.9 gesetzt, damit
Abstand zwischen den einzelnen Balken zu erkennen ist.
über _scale_fill<em>manual</em> werden die Teamfarben für geom_tile gesetzt. Ich hatte auch probiert die Fahrernamen mit den
Teamfarben auszustatten. Aber einige Farben sind etwas zu blaß und deshalb auf dem weißen Hintergrund nicht gut zu
erkennen - deshalb weggelassen.
Dann wird es mit _coord<em>cartesian</em> und _coord<em>flip</em> und _scale_y<em>reverse</em> etwas kompliziert. Vor allem _coord<em>flip</em> switched die Achsen. Nach
langem Rumfummeln habe ich aber dann gemerkt, dass die Achsenbezeichnung bleibt - also die x-Achse ist jetzt die
y-Achse, muss aber nach wie vor als x-Achse angesprochen werden.</p>

<p>Dann geht es an die eigentliche Animation über die Definition der <em>transition_states</em> . Es wird über <strong>week</strong> animiert.
<strong>transition_length</strong> definiert die Länge des Übergangs zwischen zwei Zuständen und <strong>state_length</strong> die Länge des
Zustandes. Worin die Länge gemessen wird, ist mir aber nicht klar, Sekunden, Millisekunden oder Frames?
Nach langem Experimentieren finden ich für die Darstellung aber diese Einstellung in Ordnung.</p>

<pre><code class="language-r">anim &lt;- ggplot(data = dat, mapping = aes(x = ordering, group = Name)) + 
  geom_hline(aes(yintercept = 0), alpha =0.1, color = 'gray')+
  geom_hline(aes(yintercept = 500), alpha =0.1, color = 'gray')+
  geom_hline(aes(yintercept = 1000), alpha =0.1, color = 'gray')+
  geom_tile(aes(y = SumInWeek/2, height = SumInWeek, width = .9, fill = Team)) + 
  geom_text(aes(y = -1000, label = paste(RankInWeek, '. ',Name)),
            hjust = 0, nudge_x = 0, size = 4) +
  scale_fill_manual(values = whatyouwant) +
  geom_text(aes(y = -150, label = paste(SumInWeek)),
            hjust = 0, nudge_x = 0, size = 4) +
  geom_text(aes(x = 21, y = max(SumInWeek - 120), 
                label = paste0('Woche: ', week)), col = 'black', alpha=.1, size =6) +
  theme_ridges() +
  scale_y_continuous(
    breaks = c(-500, 0, 500, 1000),
    labels = c('', '0', '500', '1000')
  )+
  theme(legend.position = 'none',
        axis.text.y = element_blank(),
        axis.ticks.x = element_blank(),
        #axis.text.x.bottom = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title = element_text(size =23)) +
  coord_cartesian(clip = &quot;off&quot;, expand = FALSE) + 
  coord_flip() +
  scale_x_reverse() +
  labs(x='', y ='Punkte',
       title = 'Top 20 Amateure 2019', subtitle = '', caption = '@ marblo') +
  transition_states(week, wrap = T, transition_length = 7, state_length = 7) +
  enter_fade() +
  ease_aes('linear') 
</code></pre>

<p>Das folgende ist jetzt ganz wichtig, um eine saubere Animation zu erhalten. Genaueres wird unter
<a href="https://github.com/ropenscilabs/learngganimate/blob/master/animate.md">learngganimate</a> beschrieben.
<strong>nframes</strong> steht für die Anzahl der insgesamt zu erzeugenden frames - das sind eigentlich jeweils einzelne gif&rsquo;s -
und <strong>fps</strong> für <em>frames per second</em>. Die Gesamtdauer der Animation ergibt sich dann aus diesen beiden Größen durch
Division.
Die Einstellungen für das Speichern sind durch Experimentieren entstanden. Ich kann noch nicht erkennen, dass die
Auflösung <strong>res</strong> einen Einfluss auf die Qualität des Gifs im Browser hat.</p>

<pre><code class="language-r">animate(anim, nframes = 200, fps =5, end_pause = 10)

# --- speichert letzte Animation als GIF
anim_save('second_I_Top20_res500_200x5_1000x1400.gif',animation = last_animation(),
          ani.width = 1000, ani.height = 1400, res =500)
</code></pre>

<div class="parent">
  <img src="../../img/2020/01/third_II_Top20_res500_300x5_1000x1400.gif">
</div>

<p>Nisi adipisicing aute enim quis sunt non veniam veniam tempor. Sit anim deserunt ad dolore consequat anim commodo. Ipsum
cillum deserunt velit consequat culpa laborum velit quis irure quis pariatur occaecat elit dolor. Ipsum labore aute
tempor ullamco nostrud ullamco. Sit in velit enim eiusmod magna deserunt. Eu pariatur dolore voluptate tempor.</p>

<div style="parent">
   <img src="../../img/2020/01/second_III_Top20_res500_400x10_1000x1400.gif">
</div>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="../../categories/r">R</a></li>
                
                
                <li><a class="article-category-link" href="../../categories/gganimate">gganimate</a></li>
                
                
                <li><a class="article-category-link" href="../../categories/stm">stm</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>


<ul class="actions pagination">
    
        <li><a href="../../stm/tagebuch/"
                class="button big previous">Tagebuch</a></li>
    

    
        <li><a href="../../stm/how-to-add-interactive-plots-to-a-blog-post/"
                class="button big next">How to add interactive plots to a Blog post</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='../../'><img src="../../img/main/mb.svg" class="intro-circle" width="250px" alt="mb&#39;s imperfect site" /></a>
      
    
    
      <header>
        <h2></h2>
        <p></p>
      </header>
    
    
      <ul class="icons">
        
        


























































  <li><a href="//twitter.com/true" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



















  <li><a href="mailto:true" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="../../blog/amateurradsport-radsport-rangliste-amateure/">Rangliste Amateure 2019</a>
              </h3>
              
              <time class="published" datetime='2020-02-02'>
                February 2, 2020
              </time>
            </header>
            
    

    
        
        







  
  
    
  


        
        
        

        <a href="../../blog/amateurradsport-radsport-rangliste-amateure/" class="image featured">
            <img src="../../img/2020/02/ranking.png" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="../../stm/sublime-markdown-text-css-und-mehr/">Sublime, Markdown, Text, CSS und mehr</a>
              </h3>
              
              <time class="published" datetime='2020-01-26'>
                January 26, 2020
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="../../stm/how-to-add-interactive-plots-to-a-blog-post/">How to add interactive plots to a Blog post</a>
              </h3>
              
              <time class="published" datetime='2020-01-22'>
                January 22, 2020
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /blog/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>mb's: hauptsächlich zur eigenen Referenz und zur Dokumentation</p>
      <a href="../../about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
        


























































  <li><a href="//twitter.com/true" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



















  <li><a href="mailto:true" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
    <p class="copyright">
      
        &copy; 2020
        
          mb`s
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/python.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/html.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="../../js/util.js"></script>
      <script src="../../js/main.js"></script>
      <script src="../../js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

